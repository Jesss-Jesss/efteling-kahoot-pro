<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Kies je personage</title>
<link rel="stylesheet" href="/style.css">
</head>
<body>

<h2>âœ” Gelukt! Je bent nu in de quiz</h2>
<p>Zie je je naam op het leaderboard?</p>

<!-- Gekozen Personage -->
<div style="margin-bottom:20px;">
    <div style="position:relative; display:inline-block;">
        <img id="chosenImage" width="130">
        <p id="chosenName" style="color:black; font-weight:bold;"></p>
    </div>
</div>

<button onclick="openGallery()">Kies / wijzig je personage</button>

<!-- GALERIJ -->
<div class="gallery-overlay" id="gallery">
    <div style="position:absolute; top:20px; right:30px; font-size:30px; cursor:pointer;" onclick="closeGallery()">âœ–</div>
    <div class="gallery-grid" id="galleryGrid"></div>
</div>

<!-- ============================= -->
<!-- SCRIPT -->
<!-- ============================= -->

<script>

/* ===============================
   HANDMATIGE GAME ID
=================================*/

const MANUAL_GAME_ID = "EFTEL-123456"; // ðŸ‘ˆ HIER JE GAME ID

const storedGameId = localStorage.getItem("gameId");

if (storedGameId !== MANUAL_GAME_ID) {
    window.location.href = "/player-step1.html";
}

const gameId = MANUAL_GAME_ID;
const name = localStorage.getItem("playerName");

if (!name) {
    window.location.href = "/player-step2.html";
}

/* ===============================
   PERSONAGES
=================================*/

const characters = [
    { name: "Jokie", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/jokie/profielen/700x610-jokie-profiel-large.png?h=610&w=700&la=nl&hash=AFCC6A2C7EE087EFB6405C06EA6976E9" },
    { name: "Jet", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/jokie/profielen/700x670-jet-profiel-large.png?h=610&w=700&la=nl&hash=6C38B23FC7863C21989C5B2F8B960EE4" },
    { name: "Assepoester", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-assepoester-profiel.png?h=610&w=700&la=nl&hash=E80F316CB0556920A36FF6E03019FE08" },
    { name: "Roodkapje", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-roodkapje-profiel.png?h=610&w=700&la=nl&hash=E6DB5FE9B79F4E7CF1B0679CC495F644" },
    { name: "Klein Duimpje", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-klein-duimpje-profiel.png?h=610&w=700&la=nl&hash=605528BD2E96980C7466246FFC39F7DC" },
    { name: "Langnek", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-langnek-profiel.png?h=610&w=700&la=nl&hash=2C9696EF6D052C75BBA3C3AFC72BB74B" },
    { name: "Wolf", img: "..." },
    { name: "Assepoester", img: "..." },
    { name: "Sneeuwwitje", img: "..." },
    { name: "Pinokkio", img: "..." },
    { name: "Doornroosje", img: "..." },
    { name: "Vrouw Holle", img: "..." },
    { name: "Repelsteeltje", img: "..." },
    { name: "Fakir", img: "..." },
    { name: "Trol", img: "..." },
    { name: "Ravelijn", img: "..." },
    { name: "Baron 1898", img: "..." },
    { name: "Draak", img: "..." },
    { name: "Ezeltje Strek Je", img: "..." },
    { name: "Hans en Grietje", img: "..." }
];
/* ===============================
   RANDOM PERSONAGE BIJ START
=================================*/

window.addEventListener("load", () => {

    const random = characters[Math.floor(Math.random() * characters.length)];

    document.getElementById("chosenImage").src = random.img;
    document.getElementById("chosenName").innerText = random.name;

    chooseCharacter(random);
});

/* ===============================
   GALERIJ OPEN / SLUIT
=================================*/

function openGallery() {
    document.getElementById("gallery").style.display = "block";
    loadGallery();
}

function closeGallery() {
    document.getElementById("gallery").style.display = "none";
}

/* ===============================
   GALERIJ LADEN
=================================*/

function loadGallery() {

    fetch("/scores-full")
    .then(res => res.json())
    .then(data => {

        const grid = document.getElementById("galleryGrid");
        grid.innerHTML = "";

        const takenCharacters = (data.players || []).map(p => p.character);

        characters.forEach(char => {

            const card = document.createElement("div");
            card.className = "character-card";

            card.innerHTML = `
                <img src="${char.img}">
                <div class="character-name">${char.name}</div>
            `;

            // ðŸ”¥ ALS BEZET â†’ GRIJS
            if (takenCharacters.includes(char.name)) {
                card.classList.add("disabled");
            } else {
                card.onclick = () => chooseCharacter(char);
            }

            grid.appendChild(card);
        });
    });
}

/* ===============================
   PERSONAGE KIEZEN
=================================*/

function chooseCharacter(char) {

    fetch("/join", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            gameId,
            name,
            character: char.name
        })
    })
    .then(res => res.json())
    .then(data => {

        if (!data.success) {
            alert(data.error);
            return;
        }

        document.getElementById("chosenImage").src = char.img;
        document.getElementById("chosenName").innerText = char.name;

        closeGallery();
    });
}

</script>

</body>
</html>
