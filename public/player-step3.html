<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Kies je personage</title>
<link rel="stylesheet" href="/style.css">
</head>
<body>

<h2>âœ” Gelukt! Je bent nu in de quiz</h2>
<p>Zie je je naam op het leaderboard?</p>

<!-- Gekozen Personage -->
<div style="margin-bottom:20px;">
    <div style="position:relative; display:inline-block;">
        <img id="chosenImage" width="130">
        <p id="chosenName" style="color:black; font-weight:bold;"></p>
    </div>
</div>

<button onclick="openGallery()">Kies / wijzig je personage</button>

<!-- GALERIJ -->
<div class="gallery-overlay" id="gallery">
    <div style="position:absolute; top:20px; right:30px; font-size:30px; cursor:pointer;" onclick="closeGallery()">âœ–</div>
    <div class="gallery-grid" id="galleryGrid"></div>
</div>

<!-- ============================= -->
<!-- SCRIPT -->
<!-- ============================= -->

<script>

/* ===============================
   HANDMATIGE GAME ID
=================================*/

const MANUAL_GAME_ID = "EFTEL-123456"; // ðŸ‘ˆ HIER JE GAME ID

const storedGameId = localStorage.getItem("gameId");

if (storedGameId !== MANUAL_GAME_ID) {
    window.location.href = "/player-step1.html";
}

const gameId = MANUAL_GAME_ID;
const name = localStorage.getItem("playerName");

if (!name) {
    window.location.href = "/player-step2.html";
}

/* ===============================
   PERSONAGES
=================================*/

const characters = [
    {
        name: "Jokie",
        img: "https://www.efteling.com/nl/-/media/images/kids/karakters/jokie/profielen/700x610-jokie-profiel-large.png"
    },
    {
        name: "Jet",
        img: "https://www.efteling.com/nl/-/media/images/kids/karakters/jokie/profielen/700x670-jet-profiel-large.png"
    },
    {
        name: "Assepoester",
        img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-assepoester-profiel.png"
    }
];

/* ===============================
   RANDOM PERSONAGE BIJ START
=================================*/

window.addEventListener("load", () => {

    const random = characters[Math.floor(Math.random() * characters.length)];

    document.getElementById("chosenImage").src = random.img;
    document.getElementById("chosenName").innerText = random.name;

    chooseCharacter(random);
});

/* ===============================
   GALERIJ OPEN / SLUIT
=================================*/

function openGallery() {
    document.getElementById("gallery").style.display = "block";
    loadGallery();
}

function closeGallery() {
    document.getElementById("gallery").style.display = "none";
}

/* ===============================
   GALERIJ LADEN
=================================*/

function loadGallery() {

    fetch("/scores-full")
    .then(res => res.json())
    .then(data => {

        const taken = data.takenCharacters || [];
        const grid = document.getElementById("galleryGrid");

        grid.innerHTML = "";

        characters.forEach(char => {

            if (taken.includes(char.name)) return;

            const card = document.createElement("div");
            card.className = "character-card";

            card.innerHTML = `
                <img src="${char.img}">
                <div class="character-name">${char.name}</div>
            `;

            card.onclick = () => chooseCharacter(char);

            grid.appendChild(card);
        });
    });
}

/* ===============================
   PERSONAGE KIEZEN
=================================*/

function chooseCharacter(char) {

    fetch("/choose-character", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            gameId,
            name,
            character: char.name
        })
    })
    .then(res => res.json())
    .then(data => {

        if (!data.success) {
            alert(data.error);
            return;
        }

        document.getElementById("chosenImage").src = char.img;
        document.getElementById("chosenName").innerText = char.name;

        document.getElementById("gallery").style.display = "none";
    });
}

</script>

</body>
</html>
