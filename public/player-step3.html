<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Kies je personage</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

    <h2>âœ” Gelukt! Je bent nu in de quiz</h2>

<p>Zie je je naam op het leaderboard?</p>

<button onclick="openGallery()">Kies / wijzig je personage</button>

<div class="gallery-overlay" id="gallery">
    <div class="gallery-grid" id="galleryGrid"></div>
</div>

    <script>
        const chars = document.querySelectorAll(".character");
        chars.forEach(c => {
            c.addEventListener("click", () => {
                const chosen = c.dataset.name;
                localStorage.setItem("character", chosen);
                window.location.href = "/player.html"; // Ga naar player scherm

                <script>
/* ðŸ”¥ NIEUW TOEGEVOEGD */

const params = new URLSearchParams(window.location.search);
const gameId = localStorage.getItem("gameId"); // we gebruiken localStorage (veiliger)
const name = localStorage.getItem("playerName");

function choose(character) {

    if (!gameId || !name) {
        alert("Er ontbreekt informatie. Ga opnieuw naar stap 1.");
        window.location.href = "/player-step1.html";
        return;
    }

    fetch("/join", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            gameId: gameId,
            name: name,
            character: character
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert("Je zit in het spel!");
        } else {
            alert(data.error);
        }
    });
}
</script>
            });
        });
    </script>

<script>

const gameId = localStorage.getItem("gameId");
const name = localStorage.getItem("playerName");

if (!gameId || !name) {
    window.location.href = "/player-step1.html";
}

const characters = [
    { name: "Jokie", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/jokie/profielen/700x610-jokie-profiel-large.png?h=610&w=700&la=nl&hash=AFCC6A2C7EE087EFB6405C06EA6976E9" },
    { name: "Jet", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/jokie/profielen/700x670-jet-profiel-large.png?h=610&w=700&la=nl&hash=6C38B23FC7863C21989C5B2F8B960EE4" },
    { name: "Assepoester", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-assepoester-profiel.png?h=610&w=700&la=nl&hash=E80F316CB0556920A36FF6E03019FE08" }
];

function openGallery() {
    document.getElementById("gallery").style.display = "block";
    loadGallery();
}

function loadGallery() {

    fetch("/scores-full")
    .then(res => res.json())
    .then(data => {

        const taken = data.takenCharacters || [];
        const grid = document.getElementById("galleryGrid");

        grid.innerHTML = "";

        characters.forEach(char => {

            if (taken.includes(char.name)) return;

            const div = document.createElement("div");
            div.className = "character-card";

            div.innerHTML = `
                <img src="${char.img}">
                <div class="character-name">${char.name}</div>
            `;

            div.onclick = () => chooseCharacter(char);

            grid.appendChild(div);
        });
    });
}

function chooseCharacter(char) {

    fetch("/choose-character", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            gameId,
            name,
            character: char.name
        })
    })
    .then(res => res.json())
    .then(data => {

        if (!data.success) {
            alert(data.error);
            return;
        }

        document.getElementById("chosenImage").src = char.img;
        document.getElementById("chosenName").innerText = char.name;

        document.getElementById("gallery").style.display = "none";
    });
}

</script>
    
</body>
</html>
