<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kies je personage</title>
<link rel="stylesheet" href="/style.css">
</head>
<body>

<h2>âœ” Gelukt! Je bent nu in de quiz</h2>
<p>Zie je je naam op het leaderboard?</p>

<!-- Gekozen Personage -->
<div style="margin-bottom:20px;">
    <div style="position:relative; display:inline-block;">
        <img id="chosenImage" width="130">
        <p id="chosenName" style="color:black; font-weight:bold;"></p>
    </div>
</div>

<button onclick="openGallery()">Kies / wijzig je personage</button>

<!-- GALERIJ -->

    <div id="galleryOverlay">

    <div id="galleryHeader">
        <button id="closeGallery">âœ–</button>
    </div>

    <div id="galleryContent">
        <div id="galleryGrid"></div>
    </div>

</div>

<!-- ============================= -->
<!-- SCRIPT -->
<!-- ============================= -->

<script>

/* ===============================
   HANDMATIGE GAME ID
=================================*/

const MANUAL_GAME_ID = "EFTEL-123456"; // ðŸ‘ˆ HIER JE GAME ID

const storedGameId = localStorage.getItem("gameId");

if (storedGameId !== MANUAL_GAME_ID) {
    window.location.href = "/player-step1.html";
}

const gameId = MANUAL_GAME_ID;
const name = localStorage.getItem("playerName");

if (!name) {
    window.location.href = "/player-step2.html";
}

/* ===============================
   PERSONAGES
=================================*/

const characters = [
    { name: "Jokie", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/jokie/profielen/700x610-jokie-profiel-large.png?h=610&w=700&la=nl&hash=AFCC6A2C7EE087EFB6405C06EA6976E9" },
    { name: "Jet", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/jokie/profielen/700x670-jet-profiel-large.png?h=610&w=700&la=nl&hash=6C38B23FC7863C21989C5B2F8B960EE4" },
    { name: "Assepoester", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-assepoester-profiel.png?h=610&w=700&la=nl&hash=E80F316CB0556920A36FF6E03019FE08" },
    { name: "Roodkapje", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-roodkapje-profiel.png?h=610&w=700&la=nl&hash=E6DB5FE9B79F4E7CF1B0679CC495F644" },
    { name: "Klein Duimpje", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-klein-duimpje-profiel.png?h=610&w=700&la=nl&hash=605528BD2E96980C7466246FFC39F7DC" },
    { name: "Langnek", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-langnek-profiel.png?h=610&w=700&la=nl&hash=2C9696EF6D052C75BBA3C3AFC72BB74B" },
    { name: "Reus", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-reus-profiel.png?h=610&w=700&la=nl&hash=F4CAB56BCBC33C27843AB55A0E53DAC2" },
    { name: "Heks", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-heks-profiel.png?h=610&w=700&la=nl&hash=64DA81E70F0BAF09720459D3F73E9398" },
    { name: "Fakir", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-fakir-profiel.png?h=610&w=700&la=nl&hash=707B192A68621B3A0CD2F6179027273E" },
    { name: "Ezel", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-ezel-profiel.png?h=610&w=700&la=nl&hash=AF48F22F5AC314A1514276E6F7E9BAE2" },
    { name: "Draak", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-draak-profiel.png?h=610&w=700&la=nl&hash=CD831613A6F3E00942F643094ECD9E8D" },
    { name: "Sprookjesboom", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-sprookjesboom-profiel.png?h=610&w=700&la=nl&hash=DDC267CCCB0BC5478DC242A4D5ADC328" },
    { name: "Geitje Benjamin", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-zeven-geitjes-profiel.png?h=610&w=700&la=nl&hash=6613F5C3124D8785544D949571CC0CE7" },
    { name: "Wolf", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-wolf-profiel.png?h=610&w=700&la=nl&hash=AEDB0449881BD1A2F20C4FCF7FE3E911" },
    { name: "Kabauter Ko", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-ko-profiel.png?h=610&w=700&la=nl&hash=24B9DEA2B0A6EC6C4D02599DCC73B668" },
    { name: "Kabauter Kie", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-kie-profiel.png?h=610&w=700&la=nl&hash=DCAB72456FE3B4FB7EBACC80D93C7F25" },
    { name: "Kabauter Kei", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-kei-profiel.png?h=610&w=700&la=nl&hash=DE15AD66000C5BED3B066514E8FCD1BB" },
    { name: "Kabauter Keu", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-keu-profiel.png?h=610&w=700&la=nl&hash=8456F9C2858528F61FB742A25464A2A1" },
    { name: "Kabauter Ke", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-ke-profiel.png?h=610&w=700&la=nl&hash=4C12A6F3C299F58644966A7343A62FEE" },
    { name: "Kabauter Ka", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-ka-profiel.png?h=610&w=700&la=nl&hash=52D9C378305DCAC05D1D91A89EE063DA" },
    { name: "Kabauter Ku", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/sprookjesboom/profielen/700x610-ku-profiel.png?h=610&w=700&la=nl&hash=73E42920753E92161AF38A15B8B75B71" },
    { name: "Pardoes", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/pardoes/profielen/700x610-pardoes-profiel.png?h=610&w=700&la=nl&hash=C339EA90B2286A73F14302CDE21A47B9" },
    { name: "Pardijn", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/pardoes/profielen/700x610-pardijn-profiel.png?h=610&w=700&la=nl&hash=55281D2A35AFDB33029A7776A4A6913C" },
    { name: "Koning Pardulfus", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/pardoes/profielen/700x610-pardulfus-profiel.png?h=610&w=700&la=nl&hash=A7DD888D1072C92415BA7C4ED4CA2B35" },
    { name: "Polle", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/pardoes/profielen/700x610-polle-profiel.png?h=610&w=700&la=nl&hash=84F17C16E9769B7C39F6EDCE68689498" },
    { name: " Grootmagister Almar", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/pardoes/profielen/700x6100-almar-profiel.png?h=610&w=700&la=nl&hash=728E0176BA4AB700145C67A7F4056280" },
    { name: "Aliciana", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/pardoes/profielen/700x610-aliciana-profiel.png?h=610&w=700&la=nl&hash=2E3CACF7E536CCDDC9E6D85E7946E42D" },
    { name: "Pantagor", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/pardoes/profielen/700x610-pantagor-profiel.png?h=610&w=700&la=nl&hash=38B351FDD14B2EB400E07DC83ADCF22C" },
    { name: "Rattar", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/pardoes/profielen/700x610-rattar-profiel.png?h=610&w=700&la=nl&hash=5DF5CC3C7EDCB42CF906C605AC8E51F5" },
    { name: "O.J. Punctuel", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/pardoes/profielen/700x610-profiel-punctuel.png?h=610&w=700&la=nl&hash=D044F1C39109C86EF5734933C819E88E" },
    { name: "Ruiter Thomas", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/raveleijn/profielen/700x610-thomas-profiel.png?h=610&w=700&la=nl&hash=62598971003A7BF48570E5CC251509D0" },
    { name: "Ruiter Joost", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/raveleijn/profielen/700x610-joost-profiel.png?h=610&w=700&la=nl&hash=A71ACD69E8C317C5F5DB1BFD903BE703" },
    { name: "Ruiter Maurits", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/raveleijn/profielen/700x610-maurits-profiel.png?h=610&w=700&la=nl&hash=2F68DD5B263DF8FDB7C606C542497101" },
    { name: "Ruiter Emma", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/raveleijn/profielen/700x610-emma-profiel.png?h=610&w=700&la=nl&hash=3B00DDFC724794FFDF6AFE37B05D3EB2" },
    { name: "Ruiter Lisa", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/raveleijn/profielen/700x610-lisa-profiel.png?h=610&w=700&la=nl&hash=D3C15A46A3336B907FB372F6A8661921" },
    { name: "Samira", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/raveleijn/profielen/700x610-samira-profiel.png?h=610&w=700&la=nl&hash=4F3135F07F99D88234D2F6F406CC1E1A" },
    { name: "SamuÃ«l", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/raveleijn/profielen/700x610-samuel-profiel.png?h=610&w=700&la=nl&hash=D3DBFA2199BBCF5A09C84185CE7B6008" },
    { name: "Graaf Olaf Grafhart", img: "https://www.efteling.com/nl/-/media/images/kids/karakters/raveleijn/profielen/700x610-graaf-olaf-grafhart-profiel.png?h=610&w=700&la=nl&hash=C487A5B11E3AA74CB8385A55020B00BC" },
];
/* ===============================
   RANDOM PERSONAGE BIJ START
=================================*/

window.addEventListener("load", () => {

    const random = characters[Math.floor(Math.random() * characters.length)];

    document.getElementById("chosenImage").src = random.img;
    document.getElementById("chosenName").innerText = random.name;

    chooseCharacter(random);
});

/* ===============================
   GALERIJ OPEN / SLUIT
=================================*/

function openGallery() {
    document.getElementById("galleryOverlay").style.display = "block";
    loadGallery();
}

function closeGallery() {
    document.getElementById("galleryOverlay").style.display = "none";
}

/* ===============================
   GALERIJ LADEN
=================================*/

function loadGallery() {

    fetch("/scores-full")
    .then(res => res.json())
    .then(data => {

        const grid = document.getElementById("galleryGrid");
        grid.innerHTML = "";

        const takenCharacters = (data.players || []).map(p => p.character);

        characters.forEach(char => {

            const card = document.createElement("div");
            card.className = "character-card";

            card.innerHTML = `
                <img src="${char.img}">
                <div class="character-name">${char.name}</div>
            `;

            if (takenCharacters.includes(char.name) && char.name !== document.getElementById("chosenName").innerText) {
                card.classList.add("disabled");
            } else {
                card.onclick = () => chooseCharacter(char);
            }

            grid.appendChild(card);
        });
    });
}

    setInterval(() => {
    if (document.getElementById("galleryOverlay").style.display === "block") {
        loadGallery();
    }
},1000);

/* ===============================
   PERSONAGE KIEZEN
=================================*/

function chooseCharacter(char) {

    fetch("/join", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            gameId,
            name,
            character: char.name
        })
    })
    .then(res => res.json())
    .then(data => {

        if (!data.success) {
            alert(data.error);
            return;
        }

        document.getElementById("chosenImage").src = char.img;
        document.getElementById("chosenName").innerText = char.name;

        closeGallery();
    });
}

</script>

</body>
</html>
