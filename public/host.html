<!DOCTYPE html>
<html>
<head>
<title>Dashboard</title>
<link rel="stylesheet" href="/style.css">
<script src="/socket.io/socket.io.js"></script>
</head>
<body>

<h1>ğŸ¢ Dashboard</h1>

<div class="container">

<div class="card">
<h2>Game Code</h2>
<p id="code"></p>
</div>

<div class="card">
<h2>Spelers</h2>
<div id="players"></div>
</div>

<div class="card">
<h2>Foutmeldingen</h2>
<div id="errors"></div>
</div>

<div class="card">
<h2>Control</h2>
<button onclick="next()">Volgende</button>
</div>

<div class="card">
<h2>Vraag instellen</h2>
<input id="question" placeholder="Vraag">
<input id="correct" placeholder="Juiste antwoorden (komma)">
<button onclick="setQ()">Opslaan</button>
</div>

<div class="card">
<h2>Antwoorden Overzicht</h2>
<div id="results"></div>
</div>

</div>

<script>
const socket=io();

fetch("/gamecode").then(r=>r.json()).then(d=>{
document.getElementById("code").innerText=d.code;
});

function next(){socket.emit("nextPhase");}
function setQ(){
socket.emit("setQuestion",{
question:document.getElementById("question").value,
correct:document.getElementById("correct").value.split(",")
});
}

socket.on("updatePlayers",players=>{
const div=document.getElementById("players");
div.innerHTML="";
players.forEach(p=>{
div.innerHTML+=`${p.name} (${p.score}) <button onclick="kick('${p.id}')">Kick</button><br>`;
});
});

function kick(id){socket.emit("kickPlayer",id);}

socket.on("updateErrors",errors=>{
const div=document.getElementById("errors");
div.innerHTML="";
errors.forEach(e=>{
div.innerHTML+=`${e.type} <button onclick="mark('${e.id}')">${e.handled?"Niet afgehandeld":"Afgehandeld"}</button><br>`;
});
});

function mark(id){socket.emit("markError",id);}

socket.on("showResults",answers=>{
const grouped={};
answers.forEach(a=>{
if(!grouped[a.normalized]){
grouped[a.normalized]={text:a.original,count:0,correct:a.correct};
}
grouped[a.normalized].count++;
});

const div=document.getElementById("results");
div.innerHTML="";

Object.values(grouped).forEach(a=>{
div.innerHTML+=`
${a.text} ${a.correct?"âœ…":"âŒ"} (${a.count})
<div class="bar"><div class="fill" style="width:${a.count*20}px"></div></div>
`;
});
});
</script>

</body>
</html>
