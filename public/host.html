<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<link rel="stylesheet" href="/style.css">
<script src="/socket.io/socket.io.js"></script>
</head>
<body>

<h1>ğŸ¢ Dashboard</h1>

<div class="card">
    <h2>Game Code</h2>
    <p id="gamecode"></p>
</div>

<div class="card">
    <h2>Vraag invoeren</h2>
    <input id="questionInput" placeholder="Typ hier je vraag">
    <br>
    <input id="correctInput" placeholder="Juiste antwoorden (komma gescheiden)">
    <br>
    <button onclick="setQuestion()">Vraag instellen</button>
    <button onclick="startQuestion()">Start (30 sec)</button>
    <button onclick="stopQuestion()">Stop & Resultaten</button>
</div>

<div class="card">
    <h2>Antwoorden binnengekomen</h2>
    <div id="liveAnswers"></div>
</div>

<div class="card">
    <h2>Resultaten</h2>
    <div id="results"></div>
</div>

<script>
const socket = io();

fetch("/gamecode")
.then(r => r.json())
.then(data => {
    document.getElementById("gamecode").innerText = data.code;
});

function setQuestion() {
    const q = document.getElementById("questionInput").value;
    const correct = document.getElementById("correctInput").value.split(",");
    socket.emit("setQuestion", { question: q, correct });
}

function startQuestion() {
    socket.emit("startQuestion");
}

function stopQuestion() {
    socket.emit("stopQuestion");
}

socket.on("showResults", answers => {
    const container = document.getElementById("results");
    container.innerHTML = "";

    const grouped = {};

    answers.forEach(a => {
        if (!grouped[a.normalized]) {
            grouped[a.normalized] = {
                text: a.original,
                count: 0,
                correct: a.correct
            };
        }
        grouped[a.normalized].count++;
    });

    Object.values(grouped).forEach(ans => {
        const div = document.createElement("div");
        div.innerHTML = `
            ${ans.text} - ${ans.count} spelers 
            ${ans.correct ? "âœ…" : "âŒ"}
            <div style="background:gray;height:20px;width:100%;">
                <div style="background:gold;height:20px;width:${ans.count * 40}px;"></div>
            </div>
        `;
        container.appendChild(div);
    });
});
</script>

</body>
</html>
